-- ======================================================================
-- 为所有角色初始化数据范围配置
-- 描述: 为系统中所有角色配置合理的默认数据访问范围
-- ======================================================================

-- 1. Super Admin (全部数据访问权限)
INSERT INTO data_scopes ("roleId", "resourceType", "scopeType", description, priority)
VALUES
  ('00000000-0000-0000-0000-000000000000', 'device', 'all', '超级管理员可查看所有设备', 1),
  ('00000000-0000-0000-0000-000000000000', 'user', 'all', '超级管理员可查看所有用户', 1),
  ('00000000-0000-0000-0000-000000000000', 'app', 'all', '超级管理员可查看所有应用', 1),
  ('00000000-0000-0000-0000-000000000000', 'order', 'all', '超级管理员可查看所有订单', 1),
  ('00000000-0000-0000-0000-000000000000', 'billing', 'all', '超级管理员可查看所有账单', 1),
  ('00000000-0000-0000-0000-000000000000', 'payment', 'all', '超级管理员可查看所有支付', 1),
  ('00000000-0000-0000-0000-000000000000', 'audit_log', 'all', '超级管理员可查看所有审计日志', 1)
ON CONFLICT ("roleId", "resourceType") DO NOTHING;

-- 2. Admin (已存在,跳过)

-- 3. Tenant Admin (租户管理员 - 本租户数据)
INSERT INTO data_scopes ("roleId", "resourceType", "scopeType", description, priority)
VALUES
  ('00000000-0000-0000-0000-000000000003', 'device', 'tenant', '租户管理员可查看本租户所有设备', 10),
  ('00000000-0000-0000-0000-000000000003', 'user', 'tenant', '租户管理员可查看本租户所有用户', 10),
  ('00000000-0000-0000-0000-000000000003', 'app', 'tenant', '租户管理员可查看本租户所有应用', 10),
  ('00000000-0000-0000-0000-000000000003', 'order', 'tenant', '租户管理员可查看本租户所有订单', 10),
  ('00000000-0000-0000-0000-000000000003', 'billing', 'tenant', '租户管理员可查看本租户所有账单', 10),
  ('00000000-0000-0000-0000-000000000003', 'payment', 'tenant', '租户管理员可查看本租户所有支付', 10),
  ('00000000-0000-0000-0000-000000000003', 'audit_log', 'tenant', '租户管理员可查看本租户审计日志', 10)
ON CONFLICT ("roleId", "resourceType") DO NOTHING;

-- 4. Department Admin (部门管理员 - 本部门及子部门数据)
INSERT INTO data_scopes ("roleId", "resourceType", "scopeType", description, priority, "includeSubDepartments")
VALUES
  ('00000000-0000-0000-0000-000000000004', 'device', 'department', '部门管理员可查看本部门及子部门设备', 20, true),
  ('00000000-0000-0000-0000-000000000004', 'user', 'department', '部门管理员可查看本部门及子部门用户', 20, true),
  ('00000000-0000-0000-0000-000000000004', 'app', 'department', '部门管理员可查看本部门及子部门应用', 20, true),
  ('00000000-0000-0000-0000-000000000004', 'order', 'department', '部门管理员可查看本部门及子部门订单', 20, true),
  ('00000000-0000-0000-0000-000000000004', 'billing', 'department', '部门管理员可查看本部门及子部门账单', 20, true),
  ('00000000-0000-0000-0000-000000000004', 'payment', 'department', '部门管理员可查看本部门及子部门支付', 20, true),
  ('00000000-0000-0000-0000-000000000004', 'audit_log', 'department', '部门管理员可查看本部门审计日志', 20, true)
ON CONFLICT ("roleId", "resourceType") DO NOTHING;

-- 5. DevOps (运维人员 - 全部设备和审计日志,租户级别其他资源)
INSERT INTO data_scopes ("roleId", "resourceType", "scopeType", description, priority)
VALUES
  ('00000000-0000-0000-0000-000000000005', 'device', 'all', 'DevOps可查看所有设备', 5),
  ('00000000-0000-0000-0000-000000000005', 'user', 'tenant', 'DevOps可查看本租户用户', 30),
  ('00000000-0000-0000-0000-000000000005', 'app', 'all', 'DevOps可查看所有应用', 5),
  ('00000000-0000-0000-0000-000000000005', 'order', 'tenant', 'DevOps可查看本租户订单', 30),
  ('00000000-0000-0000-0000-000000000005', 'billing', 'tenant', 'DevOps可查看本租户账单', 30),
  ('00000000-0000-0000-0000-000000000005', 'payment', 'tenant', 'DevOps可查看本租户支付', 30),
  ('00000000-0000-0000-0000-000000000005', 'audit_log', 'all', 'DevOps可查看所有审计日志', 5)
ON CONFLICT ("roleId", "resourceType") DO NOTHING;

-- 6. Customer Service (客服人员 - 租户级别数据)
INSERT INTO data_scopes ("roleId", "resourceType", "scopeType", description, priority)
VALUES
  ('00000000-0000-0000-0000-000000000006', 'device', 'tenant', '客服可查看本租户设备', 40),
  ('00000000-0000-0000-0000-000000000006', 'user', 'tenant', '客服可查看本租户用户', 40),
  ('00000000-0000-0000-0000-000000000006', 'app', 'tenant', '客服可查看本租户应用', 40),
  ('00000000-0000-0000-0000-000000000006', 'order', 'tenant', '客服可查看本租户订单', 40),
  ('00000000-0000-0000-0000-000000000006', 'billing', 'tenant', '客服可查看本租户账单', 40),
  ('00000000-0000-0000-0000-000000000006', 'payment', 'tenant', '客服可查看本租户支付', 40),
  ('00000000-0000-0000-0000-000000000006', 'audit_log', 'tenant', '客服可查看本租户审计日志', 40)
ON CONFLICT ("roleId", "resourceType") DO NOTHING;

-- 7. Auditor (审计员 - 全部审计日志,租户级其他数据)
INSERT INTO data_scopes ("roleId", "resourceType", "scopeType", description, priority)
VALUES
  ('00000000-0000-0000-0000-000000000007', 'device', 'tenant', '审计员可查看本租户设备', 50),
  ('00000000-0000-0000-0000-000000000007', 'user', 'tenant', '审计员可查看本租户用户', 50),
  ('00000000-0000-0000-0000-000000000007', 'app', 'tenant', '审计员可查看本租户应用', 50),
  ('00000000-0000-0000-0000-000000000007', 'order', 'tenant', '审计员可查看本租户订单', 50),
  ('00000000-0000-0000-0000-000000000007', 'billing', 'all', '审计员可查看所有账单', 5),
  ('00000000-0000-0000-0000-000000000007', 'payment', 'all', '审计员可查看所有支付', 5),
  ('00000000-0000-0000-0000-000000000007', 'audit_log', 'all', '审计员可查看所有审计日志', 5)
ON CONFLICT ("roleId", "resourceType") DO NOTHING;

-- 8. Finance (财务人员 - 全部财务相关,租户级其他)
INSERT INTO data_scopes ("roleId", "resourceType", "scopeType", description, priority)
VALUES
  ('00000000-0000-0000-0000-000000000008', 'device', 'tenant', '财务可查看本租户设备', 60),
  ('00000000-0000-0000-0000-000000000008', 'user', 'tenant', '财务可查看本租户用户', 60),
  ('00000000-0000-0000-0000-000000000008', 'app', 'tenant', '财务可查看本租户应用', 60),
  ('00000000-0000-0000-0000-000000000008', 'order', 'all', '财务可查看所有订单', 5),
  ('00000000-0000-0000-0000-000000000008', 'billing', 'all', '财务可查看所有账单', 5),
  ('00000000-0000-0000-0000-000000000008', 'payment', 'all', '财务可查看所有支付', 5),
  ('00000000-0000-0000-0000-000000000008', 'audit_log', 'tenant', '财务可查看本租户审计日志', 60)
ON CONFLICT ("roleId", "resourceType") DO NOTHING;

-- 9. Accountant (会计 - 租户级财务数据)
INSERT INTO data_scopes ("roleId", "resourceType", "scopeType", description, priority)
VALUES
  ('00000000-0000-0000-0000-000000000009', 'device', 'tenant', '会计可查看本租户设备', 70),
  ('00000000-0000-0000-0000-000000000009', 'user', 'tenant', '会计可查看本租户用户', 70),
  ('00000000-0000-0000-0000-000000000009', 'app', 'tenant', '会计可查看本租户应用', 70),
  ('00000000-0000-0000-0000-000000000009', 'order', 'tenant', '会计可查看本租户订单', 70),
  ('00000000-0000-0000-0000-000000000009', 'billing', 'tenant', '会计可查看本租户账单', 70),
  ('00000000-0000-0000-0000-000000000009', 'payment', 'tenant', '会计可查看本租户支付', 70),
  ('00000000-0000-0000-0000-000000000009', 'audit_log', 'tenant', '会计可查看本租户审计日志', 70)
ON CONFLICT ("roleId", "resourceType") DO NOTHING;

-- 10. VIP User (VIP用户 - 租户级数据)
INSERT INTO data_scopes ("roleId", "resourceType", "scopeType", description, priority)
VALUES
  ('00000000-0000-0000-0000-000000000010', 'device', 'tenant', 'VIP用户可查看本租户设备', 80),
  ('00000000-0000-0000-0000-000000000010', 'user', 'self', 'VIP用户只能查看自己的用户信息', 80),
  ('00000000-0000-0000-0000-000000000010', 'app', 'tenant', 'VIP用户可查看本租户应用', 80),
  ('00000000-0000-0000-0000-000000000010', 'order', 'self', 'VIP用户只能查看自己的订单', 80),
  ('00000000-0000-0000-0000-000000000010', 'billing', 'self', 'VIP用户只能查看自己的账单', 80),
  ('00000000-0000-0000-0000-000000000010', 'payment', 'self', 'VIP用户只能查看自己的支付', 80),
  ('00000000-0000-0000-0000-000000000010', 'audit_log', 'self', 'VIP用户只能查看自己的审计日志', 80)
ON CONFLICT ("roleId", "resourceType") DO NOTHING;

-- 11. Enterprise User (企业用户 - 租户级数据)
INSERT INTO data_scopes ("roleId", "resourceType", "scopeType", description, priority)
VALUES
  ('00000000-0000-0000-0000-000000000011', 'device', 'tenant', '企业用户可查看本租户设备', 90),
  ('00000000-0000-0000-0000-000000000011', 'user', 'tenant', '企业用户可查看本租户用户', 90),
  ('00000000-0000-0000-0000-000000000011', 'app', 'tenant', '企业用户可查看本租户应用', 90),
  ('00000000-0000-0000-0000-000000000011', 'order', 'tenant', '企业用户可查看本租户订单', 90),
  ('00000000-0000-0000-0000-000000000011', 'billing', 'tenant', '企业用户可查看本租户账单', 90),
  ('00000000-0000-0000-0000-000000000011', 'payment', 'tenant', '企业用户可查看本租户支付', 90),
  ('00000000-0000-0000-0000-000000000011', 'audit_log', 'tenant', '企业用户可查看本租户审计日志', 90)
ON CONFLICT ("roleId", "resourceType") DO NOTHING;

-- 12. Developer (开发人员 - 租户级设备和应用,自己的其他数据)
INSERT INTO data_scopes ("roleId", "resourceType", "scopeType", description, priority)
VALUES
  ('00000000-0000-0000-0000-000000000012', 'device', 'tenant', '开发人员可查看本租户设备', 100),
  ('00000000-0000-0000-0000-000000000012', 'user', 'self', '开发人员只能查看自己的用户信息', 100),
  ('00000000-0000-0000-0000-000000000012', 'app', 'tenant', '开发人员可查看本租户应用', 100),
  ('00000000-0000-0000-0000-000000000012', 'order', 'self', '开发人员只能查看自己的订单', 100),
  ('00000000-0000-0000-0000-000000000012', 'billing', 'self', '开发人员只能查看自己的账单', 100),
  ('00000000-0000-0000-0000-000000000012', 'payment', 'self', '开发人员只能查看自己的支付', 100),
  ('00000000-0000-0000-0000-000000000012', 'audit_log', 'self', '开发人员只能查看自己的审计日志', 100)
ON CONFLICT ("roleId", "resourceType") DO NOTHING;

-- 13. Test User (测试用户 - 租户级设备和应用,自己的其他数据)
INSERT INTO data_scopes ("roleId", "resourceType", "scopeType", description, priority)
VALUES
  ('00000000-0000-0000-0000-000000000013', 'device', 'tenant', '测试用户可查看本租户设备', 110),
  ('00000000-0000-0000-0000-000000000013', 'user', 'self', '测试用户只能查看自己的用户信息', 110),
  ('00000000-0000-0000-0000-000000000013', 'app', 'tenant', '测试用户可查看本租户应用', 110),
  ('00000000-0000-0000-0000-000000000013', 'order', 'self', '测试用户只能查看自己的订单', 110),
  ('00000000-0000-0000-0000-000000000013', 'billing', 'self', '测试用户只能查看自己的账单', 110),
  ('00000000-0000-0000-0000-000000000013', 'payment', 'self', '测试用户只能查看自己的支付', 110),
  ('00000000-0000-0000-0000-000000000013', 'audit_log', 'self', '测试用户只能查看自己的审计日志', 110)
ON CONFLICT ("roleId", "resourceType") DO NOTHING;

-- 14. Readonly User (只读用户 - 只能查看自己的数据)
INSERT INTO data_scopes ("roleId", "resourceType", "scopeType", description, priority)
VALUES
  ('00000000-0000-0000-0000-000000000014', 'device', 'self', '只读用户只能查看自己的设备', 120),
  ('00000000-0000-0000-0000-000000000014', 'user', 'self', '只读用户只能查看自己的用户信息', 120),
  ('00000000-0000-0000-0000-000000000014', 'app', 'self', '只读用户只能查看自己的应用', 120),
  ('00000000-0000-0000-0000-000000000014', 'order', 'self', '只读用户只能查看自己的订单', 120),
  ('00000000-0000-0000-0000-000000000014', 'billing', 'self', '只读用户只能查看自己的账单', 120),
  ('00000000-0000-0000-0000-000000000014', 'payment', 'self', '只读用户只能查看自己的支付', 120),
  ('00000000-0000-0000-0000-000000000014', 'audit_log', 'self', '只读用户只能查看自己的审计日志', 120)
ON CONFLICT ("roleId", "resourceType") DO NOTHING;

-- 15. Guest (访客 - 只能查看自己的数据)
INSERT INTO data_scopes ("roleId", "resourceType", "scopeType", description, priority)
VALUES
  ('00000000-0000-0000-0000-000000000015', 'device', 'self', '访客只能查看自己的设备', 130),
  ('00000000-0000-0000-0000-000000000015', 'user', 'self', '访客只能查看自己的用户信息', 130),
  ('00000000-0000-0000-0000-000000000015', 'app', 'self', '访客只能查看自己的应用', 130),
  ('00000000-0000-0000-0000-000000000015', 'order', 'self', '访客只能查看自己的订单', 130),
  ('00000000-0000-0000-0000-000000000015', 'billing', 'self', '访客只能查看自己的账单', 130),
  ('00000000-0000-0000-0000-000000000015', 'payment', 'self', '访客只能查看自己的支付', 130),
  ('00000000-0000-0000-0000-000000000015', 'audit_log', 'self', '访客只能查看自己的审计日志', 130)
ON CONFLICT ("roleId", "resourceType") DO NOTHING;

-- 16. Data Analyst (数据分析师 - 全部审计日志和账单,租户级其他)
INSERT INTO data_scopes ("roleId", "resourceType", "scopeType", description, priority)
VALUES
  ('00000000-0000-0000-0000-000000000016', 'device', 'tenant', '数据分析师可查看本租户设备', 140),
  ('00000000-0000-0000-0000-000000000016', 'user', 'tenant', '数据分析师可查看本租户用户', 140),
  ('00000000-0000-0000-0000-000000000016', 'app', 'tenant', '数据分析师可查看本租户应用', 140),
  ('00000000-0000-0000-0000-000000000016', 'order', 'all', '数据分析师可查看所有订单', 5),
  ('00000000-0000-0000-0000-000000000016', 'billing', 'all', '数据分析师可查看所有账单', 5),
  ('00000000-0000-0000-0000-000000000016', 'payment', 'all', '数据分析师可查看所有支付', 5),
  ('00000000-0000-0000-0000-000000000016', 'audit_log', 'all', '数据分析师可查看所有审计日志', 5)
ON CONFLICT ("roleId", "resourceType") DO NOTHING;

-- 查看插入结果
SELECT COUNT(*) as total_configs FROM data_scopes;
SELECT r.name, COUNT(ds.id) as config_count
FROM roles r
LEFT JOIN data_scopes ds ON r.id = ds."roleId"
GROUP BY r.id, r.name
ORDER BY r.name;
