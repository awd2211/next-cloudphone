# 数据库脚本执行记录

## 概述

本目录包含云手机平台的所有数据库初始化和优化脚本。

**当前权限总数**: 284
**当前角色总数**: 17

---

## 脚本执行顺序

### 1. 基础初始化（已执行）

#### `init-databases.sql`
- **执行时间**: 项目初期
- **功能**: 创建数据库、表结构
- **数据库**: cloudphone, cloudphone_user, cloudphone_device, cloudphone_notification

---

### 2. 权限系统优化（2025-11-06）

#### 2.1 `init-permissions-and-roles.sql` ⚠️ 已废弃
- **执行时间**: 2025-11-06 早期
- **功能**: 初始权限和角色（151个权限）
- **状态**: ⚠️ 已被后续脚本替代，不要再执行

#### 2.2 `add-missing-permissions.sql` ✅ 已执行
- **执行时间**: 2025-11-06
- **功能**: 补充代码中缺失的 29 个权限
- **影响**: 权限数从 151 → 180

#### 2.3 `fix-admin-roles.sql` ✅ 已执行
- **执行时间**: 2025-11-06
- **功能**: 创建 super_admin 角色，调整 admin 为普通管理员
- **影响**: 角色数 16 → 17

---

### 3. RBAC 优化实施（2025-11-06）

#### 3.1 `rbac-optimization-mvp.sql` ✅ 已执行
- **功能**: MVP 优化 - 资源所有权、批量操作、成本控制
- **影响**: 权限数 180 → 220 (+40个)
- **新增**: 资源所有权(16) + 批量操作(14) + 成本控制(10)

#### 3.2 `rbac-approval-workflow.sql` ✅ 已执行
- **功能**: 审批工作流权限
- **影响**: 权限数 220 → 253 (+33个)
- **新增**: 申请(10) + 审批(10) + 执行(7) + 管理(8)

#### 3.3 `rbac-device-lifecycle.sql` ✅ 已执行
- **功能**: 设备生命周期权限
- **影响**: 权限数 253 → 284 (+31个)
- **新增**: 创建(3) + 启动(3) + 停止(4) + 维护(4) + 归档(5) + 查询(4) + 配置(4) + 应用(4)

---

## 相关文档

- `docs/RBAC_OPTIMIZATION_RECOMMENDATIONS.md` - RBAC 优化建议（完整版）
- `docs/RBAC_OPTIMIZATION_RESULTS.md` - RBAC 优化成果报告

**维护者**: Claude Code
**最后更新**: 2025-11-06
