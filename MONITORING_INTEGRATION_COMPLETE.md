# ç›‘æ§ç³»ç»Ÿé›†æˆå®ŒæˆæŠ¥å‘Š

**å®Œæˆæ—¶é—´**: 2025-10-21  
**ç³»ç»Ÿç»„ä»¶**: Envoy + Consul + Jaeger + Prometheus + Grafana  
**çŠ¶æ€**: âœ… å®Œå…¨é›†æˆï¼Œå¯ç«‹å³éƒ¨ç½²

---

## ğŸ‰ å·²å®Œæˆçš„ä¸‰å¤§é›†æˆ

### âœ… 1. Consul æœåŠ¡å‘ç°é›†æˆ

**é…ç½®æ–‡ä»¶**: `infrastructure/envoy/envoy-with-consul.yaml`

**åŠŸèƒ½**:
- âœ… åŠ¨æ€æœåŠ¡å‘ç°ï¼ˆEDS - Endpoint Discovery Serviceï¼‰
- âœ… è‡ªåŠ¨æ³¨å†Œ/æ³¨é”€
- âœ… å¥åº·æ£€æŸ¥é›†æˆ
- âœ… è´Ÿè½½å‡è¡¡

**å·¥ä½œåŸç†**:
```
å¾®æœåŠ¡å¯åŠ¨ â†’ æ³¨å†Œåˆ° Consul â†’ Envoy ä» Consul è·å–åœ°å€
          â†“
å¾®æœåŠ¡ä¸‹çº¿ â†’ ä» Consul æ³¨é”€ â†’ Envoy è‡ªåŠ¨ç§»é™¤
```

**ä½¿ç”¨æ–¹å¼**:
```bash
# ä½¿ç”¨ Consul é›†æˆçš„ Envoy é…ç½®
docker run -v $(pwd)/envoy-with-consul.yaml:/etc/envoy/envoy.yaml \
  envoyproxy/envoy:v1.28-latest
```

---

### âœ… 2. Jaeger åˆ†å¸ƒå¼è¿½è¸ªé›†æˆ

**é…ç½®æ–‡ä»¶**: `infrastructure/monitoring/docker-compose.monitoring.yml`

**åŠŸèƒ½**:
- âœ… å®Œæ•´çš„è°ƒç”¨é“¾è¿½è¸ª
- âœ… æ€§èƒ½ç“¶é¢ˆåˆ†æ
- âœ… æœåŠ¡ä¾èµ–å¯è§†åŒ–
- âœ… 100% é‡‡æ ·ç‡ï¼ˆå¯è°ƒæ•´ï¼‰

**è¿½è¸ªæµç¨‹**:
```
1. Envoy ç”Ÿæˆ Trace ID
2. ä¼ é€’ç»™ä¸‹æ¸¸æœåŠ¡ï¼ˆX-B3-TraceIdï¼‰
3. æ¯ä¸ªæœåŠ¡åˆ›å»º Span
4. å‘é€åˆ° Jaeger Collector
5. Jaeger UI å¯è§†åŒ–
```

**è®¿é—®åœ°å€**: http://localhost:16686

**é›†æˆçŠ¶æ€**:
- âœ… Envoy é…ç½®å®Œæˆ
- âœ… Jaeger æœåŠ¡å°±ç»ª
- âœ… è¿½è¸ªä¸Šä¸‹æ–‡ä¼ é€’
- âœ… Zipkin å…¼å®¹ç«¯ç‚¹

---

### âœ… 3. Prometheus + Grafana ç›‘æ§é›†æˆ

**é…ç½®æ–‡ä»¶**: 
- `infrastructure/monitoring/prometheus/prometheus.yml`
- `infrastructure/monitoring/prometheus/alert.rules.yml`
- `infrastructure/monitoring/docker-compose.monitoring.yml`

**åŠŸèƒ½**:
- âœ… Envoy æŒ‡æ ‡æ”¶é›†
- âœ… ç³»ç»Ÿèµ„æºç›‘æ§
- âœ… å¾®æœåŠ¡æŒ‡æ ‡
- âœ… å‘Šè­¦è§„åˆ™ï¼ˆ20+ æ¡ï¼‰
- âœ… Grafana å¯è§†åŒ–
- âœ… AlertManager å‘Šè­¦

**ç›‘æ§æŒ‡æ ‡**:
```
Envoy:
  - è¯·æ±‚é‡ (QPS)
  - å“åº”æ—¶é—´ (P50/P95/P99)
  - é”™è¯¯ç‡
  - ç†”æ–­å™¨çŠ¶æ€
  - è¿æ¥æ± ä½¿ç”¨ç‡

ç³»ç»Ÿ:
  - CPU ä½¿ç”¨ç‡
  - å†…å­˜ä½¿ç”¨ç‡
  - ç£ç›˜ I/O
  - ç½‘ç»œæµé‡

å¾®æœåŠ¡:
  - æœåŠ¡å¥åº·çŠ¶æ€
  - API é”™è¯¯ç‡
  - æ•°æ®åº“è¿æ¥æ•°
```

**è®¿é—®åœ°å€**:
- Prometheus: http://localhost:9090
- Grafana: http://localhost:3000 (admin/admin123)
- AlertManager: http://localhost:9093

---

## ğŸ“¦ å·²åˆ›å»ºçš„æ–‡ä»¶æ¸…å•

### Consul é›†æˆ
```
infrastructure/envoy/
â””â”€â”€ envoy-with-consul.yaml        # Envoy + Consul é…ç½®ï¼ˆ500+ è¡Œï¼‰
```

### Jaeger + Prometheus + Grafana
```
infrastructure/monitoring/
â”œâ”€â”€ docker-compose.monitoring.yml          # Docker Compose é…ç½®
â”œâ”€â”€ start-monitoring.sh                    # ä¸€é”®å¯åŠ¨è„šæœ¬ âœ¨
â”œâ”€â”€ README.md                              # å®Œæ•´æ–‡æ¡£ï¼ˆ500+ è¡Œï¼‰
â”‚
â”œâ”€â”€ prometheus/
â”‚   â”œâ”€â”€ prometheus.yml                     # Prometheus é…ç½®
â”‚   â”œâ”€â”€ alert.rules.yml                    # å‘Šè­¦è§„åˆ™ï¼ˆ20+ æ¡ï¼‰
â”‚   â””â”€â”€ alertmanager.yml                   # AlertManager é…ç½®
â”‚
â””â”€â”€ grafana/
    â””â”€â”€ provisioning/
        â”œâ”€â”€ datasources/
        â”‚   â””â”€â”€ datasources.yml           # æ•°æ®æºé…ç½®
        â””â”€â”€ dashboards/
            â””â”€â”€ dashboards.yml            # ä»ªè¡¨ç›˜é…ç½®
```

---

## ğŸš€ ä¸€é”®å¯åŠ¨

### 1. å¯åŠ¨å®Œæ•´ç›‘æ§ç³»ç»Ÿ

```bash
cd infrastructure/monitoring
./start-monitoring.sh
```

**é¢„æœŸè¾“å‡º**:
```
============================================
  ç›‘æ§ç³»ç»Ÿå¯åŠ¨è„šæœ¬
  Jaeger + Prometheus + Grafana
============================================

[SUCCESS] Docker å·²å®‰è£…
[SUCCESS] ç½‘ç»œå·²å­˜åœ¨
[SUCCESS] ç›‘æ§ç³»ç»Ÿå¯åŠ¨æˆåŠŸ
[SUCCESS] Jaeger å·²å°±ç»ª
[SUCCESS] Prometheus å·²å°±ç»ª
[SUCCESS] Grafana å·²å°±ç»ª

============================================
[SUCCESS] ç›‘æ§ç³»ç»Ÿå·²æˆåŠŸå¯åŠ¨ï¼
============================================

ğŸ” Jaeger: http://localhost:16686
ğŸ“Š Prometheus: http://localhost:9090
ğŸ“ˆ Grafana: http://localhost:3000
```

### 2. å¯åŠ¨ Envoyï¼ˆå¸¦ Consul + Jaegerï¼‰

```bash
cd infrastructure/envoy

# ä½¿ç”¨ Consul é›†æˆé…ç½®
docker run -d \
  --name cloudphone-envoy \
  --network cloudphone-network \
  -p 10000:10000 \
  -p 9901:9901 \
  -v $(pwd)/envoy-with-consul.yaml:/etc/envoy/envoy.yaml \
  envoyproxy/envoy:v1.28-latest
```

---

## ğŸ¯ å®Œæ•´é›†æˆéªŒè¯

### éªŒè¯ Consul æœåŠ¡å‘ç°

```bash
# 1. å¯åŠ¨ Consul
docker-compose -f docker-compose.dev.yml up -d consul

# 2. æ£€æŸ¥æœåŠ¡æ³¨å†Œ
curl http://localhost:8500/v1/catalog/services

# 3. å¯åŠ¨å¾®æœåŠ¡ï¼ˆä¼šè‡ªåŠ¨æ³¨å†Œåˆ° Consulï¼‰
./START_ALL_LOCAL.sh

# 4. éªŒè¯ Envoy è·å–åˆ°æœåŠ¡
curl http://localhost:9901/clusters | grep user-service

# é¢„æœŸï¼šçœ‹åˆ°ä» Consul å‘ç°çš„æœåŠ¡åœ°å€
```

### éªŒè¯ Jaeger è¿½è¸ª

```bash
# 1. ç¡®ä¿ Jaeger è¿è¡Œ
curl http://localhost:16686

# 2. ç¡®ä¿ Envoy é…ç½®äº†è¿½è¸ª
curl http://localhost:9901/config_dump | jq '.configs[].bootstrap.tracing'

# 3. å‘é€æµ‹è¯•è¯·æ±‚ï¼ˆå¼ºåˆ¶é‡‡æ ·ï¼‰
curl -H "X-B3-Sampled: 1" http://localhost:10000/api/users

# 4. è®¿é—® Jaeger UI
æ‰“å¼€: http://localhost:16686

# 5. æŸ¥çœ‹è¿½è¸ª
- é€‰æ‹©æœåŠ¡: api-gateway
- ç‚¹å‡» "Find Traces"
- æŸ¥çœ‹è°ƒç”¨é“¾è·¯
```

**é¢„æœŸè¿½è¸ªè§†å›¾**:
```
Trace ID: abc-123-def
æ€»è€—æ—¶: 135ms

â”œâ”€ api-gateway (5ms)
â”‚   â””â”€ user-service (10ms)
â”‚       â”œâ”€ PostgreSQL (8ms)
â”‚       â””â”€ Redis (1ms)
```

### éªŒè¯ Prometheus æŒ‡æ ‡

```bash
# 1. æ£€æŸ¥ Prometheus å¥åº·
curl http://localhost:9090/-/healthy

# 2. æŸ¥çœ‹æŠ“å–ç›®æ ‡
curl http://localhost:9090/api/v1/targets | jq '.data.activeTargets'

# 3. æŸ¥è¯¢ Envoy æŒ‡æ ‡
curl 'http://localhost:9090/api/v1/query?query=envoy_cluster_upstream_rq_total'

# 4. è®¿é—® Prometheus UI
æ‰“å¼€: http://localhost:9090

# 5. æ‰§è¡ŒæŸ¥è¯¢
sum(rate(envoy_cluster_upstream_rq_total[5m])) by (envoy_cluster_name)
```

### éªŒè¯ Grafana å¯è§†åŒ–

```bash
# 1. è®¿é—® Grafana
æ‰“å¼€: http://localhost:3000

# 2. ç™»å½•
è´¦å·: admin
å¯†ç : admin123

# 3. éªŒè¯æ•°æ®æº
Configuration â†’ Data Sources
- Prometheus: âœ… åº”è¯¥æ˜¾ç¤ºç»¿è‰²
- Jaeger: âœ… åº”è¯¥æ˜¾ç¤ºç»¿è‰²

# 4. å¯¼å…¥ä»ªè¡¨ç›˜
Dashboards â†’ Import
Dashboard ID: 11021 (Envoy Global)
æ•°æ®æº: Prometheus
```

---

## ğŸ“Š å¯è§†åŒ–æ•ˆæœé¢„è§ˆ

### Jaeger è°ƒç”¨é“¾è·¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Trace: åˆ›å»ºè®¾å¤‡è¯·æ±‚                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚ â”‚ api-gateway (5ms)                       â”‚     â”‚
â”‚ â”‚ â”œâ”€ user-service (10ms)                  â”‚     â”‚
â”‚ â”‚ â”‚  â”œâ”€ PostgreSQL (8ms)                  â”‚     â”‚
â”‚ â”‚ â”‚  â””â”€ Redis (1ms) âœ… ç¼“å­˜å‘½ä¸­           â”‚     â”‚
â”‚ â”‚ â””â”€ device-service (120ms)               â”‚     â”‚
â”‚ â”‚    â”œâ”€ PostgreSQL (20ms)                 â”‚     â”‚
â”‚ â”‚    â”œâ”€ Docker API (80ms) âš ï¸ æ…¢           â”‚     â”‚
â”‚ â”‚    â”œâ”€ Redis (2ms)                       â”‚     â”‚
â”‚ â”‚    â””â”€ RabbitMQ (5ms)                    â”‚     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                  â”‚
â”‚ æ€»è€—æ—¶: 135ms                                    â”‚
â”‚ ç“¶é¢ˆ: Docker API åˆ›å»ºå®¹å™¨ (80ms)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Grafana ä»ªè¡¨ç›˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ äº‘æ‰‹æœºå¹³å°ç›‘æ§å¤§ç›˜                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                               â”‚
â”‚ æ€»è¯·æ±‚é‡:  1,234 req/s  â†—                    â”‚
â”‚ å¹³å‡å»¶è¿Ÿ:  45ms         â†˜                    â”‚
â”‚ é”™è¯¯ç‡:    0.02%        âœ…                   â”‚
â”‚ æœåŠ¡çŠ¶æ€:  8/8 æ­£å¸¸     âœ…                   â”‚
â”‚                                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚   QPS è¶‹åŠ¿å›¾     â”‚  â”‚  å“åº”æ—¶é—´åˆ†å¸ƒ    â”‚    â”‚
â”‚ â”‚  â–‚â–ƒâ–…â–†â–ˆâ–†â–…â–ƒâ–‚     â”‚  â”‚  P50: 30ms      â”‚    â”‚
â”‚ â”‚                 â”‚  â”‚  P95: 80ms      â”‚    â”‚
â”‚ â”‚                 â”‚  â”‚  P99: 150ms     â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ æœåŠ¡å¥åº·çŠ¶æ€     â”‚  â”‚  ç†”æ–­å™¨çŠ¶æ€      â”‚    â”‚
â”‚ â”‚ user-service âœ… â”‚  â”‚  å…¨éƒ¨æ­£å¸¸ âœ…     â”‚    â”‚
â”‚ â”‚ device-svc   âœ… â”‚  â”‚                 â”‚    â”‚
â”‚ â”‚ billing-svc  âœ… â”‚  â”‚  0 ä¸ªæ‰“å¼€       â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ å®Œæ•´ç›‘æ§æµç¨‹æ¼”ç¤º

### åœºæ™¯ï¼šæ€§èƒ½é—®é¢˜è¯Šæ–­

```
1. ç”¨æˆ·åé¦ˆï¼šåˆ›å»ºè®¾å¤‡å¾ˆæ…¢ï¼ˆ5ç§’ï¼‰

2. Grafana æŸ¥çœ‹ ğŸ“ˆ
   â†’ è®¿é—®æœåŠ¡ç›‘æ§ä»ªè¡¨ç›˜
   â†’ å‘ç° device-service P99 å»¶è¿Ÿ 5s
   â†’ ç¡®è®¤é—®é¢˜æŒç»­ 1 å°æ—¶

3. Prometheus æŸ¥è¯¢ ğŸ“Š
   â†’ æ‰§è¡Œ PromQL:
     histogram_quantile(0.99, 
       rate(envoy_cluster_upstream_rq_time_bucket{
         envoy_cluster_name="device-service"
       }[5m])
     )
   â†’ æŸ¥çœ‹è¶‹åŠ¿å›¾
   â†’ å®šä½é—®é¢˜å¼€å§‹æ—¶é—´

4. Jaeger è¿½è¸ª ğŸ”
   â†’ æœç´¢ device-service æ…¢è¯·æ±‚
   â†’ ç­›é€‰ duration > 3s
   â†’ æŸ¥çœ‹è°ƒç”¨é“¾è·¯
   â†’ å‘ç° Docker API è€—æ—¶ 4.5s

5. å®šä½æ ¹å›  ğŸ¯
   â†’ Docker å®ˆæŠ¤è¿›ç¨‹è´Ÿè½½è¿‡é«˜
   â†’ å®¹å™¨åˆ›å»ºé˜Ÿåˆ—ç§¯å‹
   â†’ éœ€è¦ä¼˜åŒ–å®¹å™¨åˆ›å»ºç­–ç•¥

6. è§£å†³æ–¹æ¡ˆ âœ…
   â†’ å®ç°å®¹å™¨æ± é¢„çƒ­
   â†’ å‡å°‘å³æ—¶åˆ›å»º
   â†’ ç›‘æ§æŒ‡æ ‡ç¡®è®¤æ¢å¤æ­£å¸¸
```

---

## ğŸ”” å‘Šè­¦é…ç½®

### å·²é…ç½®çš„å‘Šè­¦è§„åˆ™ï¼ˆ20+ æ¡ï¼‰

#### ç³»ç»Ÿçº§åˆ«
- âœ… CPU ä½¿ç”¨ç‡ > 80%
- âœ… å†…å­˜ä½¿ç”¨ç‡ > 85%
- âœ… ç£ç›˜ç©ºé—´ < 20%

#### Envoy ç½‘å…³
- âœ… Envoy ä¸‹çº¿
- âœ… 5xx é”™è¯¯ç‡ > 5%
- âœ… ç†”æ–­å™¨æ‰“å¼€
- âœ… P99 å»¶è¿Ÿ > 1s

#### å¾®æœåŠ¡
- âœ… æœåŠ¡ä¸‹çº¿
- âœ… API é”™è¯¯ç‡ > 5%

#### æ•°æ®åº“
- âœ… PostgreSQL ä¸‹çº¿
- âœ… è¿æ¥æ•° > 100
- âœ… Redis ä¸‹çº¿

#### æ¶ˆæ¯é˜Ÿåˆ—
- âœ… RabbitMQ ä¸‹çº¿
- âœ… é˜Ÿåˆ—æ¶ˆæ¯å †ç§¯ > 1000

### å‘Šè­¦é€šçŸ¥æ¸ é“

**å·²é…ç½®ï¼ˆéœ€è¦å¡«å†™å‡­æ®ï¼‰**:
```yaml
- é‚®ä»¶é€šçŸ¥ âœ‰ï¸
- Slack é€šçŸ¥ ğŸ’¬
- é’‰é’‰é€šçŸ¥ ğŸ””
- ä¼ä¸šå¾®ä¿¡ ğŸ“±
```

**é…ç½®æ–‡ä»¶**: `prometheus/alertmanager.yml`

---

## ğŸ“ å­¦ä¹ èµ„æº

### å®˜æ–¹æ–‡æ¡£
- **Consul**: https://www.consul.io/docs
- **Jaeger**: https://www.jaegertracing.io/docs/
- **Prometheus**: https://prometheus.io/docs/
- **Grafana**: https://grafana.com/docs/

### æ¨èä»ªè¡¨ç›˜
- Envoy Global: ID 11021
- Node Exporter: ID 1860
- NestJS: ID 12230

---

## ğŸ”§ é«˜çº§åŠŸèƒ½

### 1. ä» Consul è‡ªåŠ¨å‘ç°æœåŠ¡

**å·²é…ç½®åœ¨ Prometheus**:
```yaml
- job_name: 'consul-services'
  consul_sd_configs:
  - server: 'consul:8500'
```

**æ•ˆæœ**ï¼šæ–°æœåŠ¡æ³¨å†Œåˆ° Consul åï¼ŒPrometheus è‡ªåŠ¨å¼€å§‹æŠ“å–æŒ‡æ ‡

### 2. åˆ†å¸ƒå¼è¿½è¸ªä¸æ—¥å¿—å…³è”

**Grafana é…ç½®**:
```yaml
tracesToLogs:
  datasourceUid: 'loki'
  tags: ['instance', 'service']
```

**æ•ˆæœ**ï¼šä»è¿½è¸ªè·³è½¬åˆ°æ—¥å¿—ï¼ŒæŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯

### 3. å‘Šè­¦é™é»˜

```bash
# ç»´æŠ¤æœŸé—´é™é»˜å‘Šè­¦
curl -X POST http://localhost:9093/api/v1/silences \
  -d '{
    "matchers": [{
      "name": "alertname",
      "value": ".*",
      "isRegex": true
    }],
    "startsAt": "2025-10-21T20:00:00Z",
    "endsAt": "2025-10-21T22:00:00Z",
    "comment": "Planned maintenance"
  }'
```

---

## ğŸ“ˆ æ€§èƒ½å½±å“è¯„ä¼°

### Jaeger è¿½è¸ª
```
å¼€é”€: < 1%
å»¶è¿Ÿå¢åŠ : < 1ms
å­˜å‚¨: ~100MB/å¤© (1000 req/s, 100% é‡‡æ ·)

å»ºè®®: ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ 1-10% é‡‡æ ·ç‡
```

### Prometheus æŠ“å–
```
å¼€é”€: < 0.5%
ç½‘ç»œ: ~10KB/s per target
å­˜å‚¨: ~1GB/æœˆ (é»˜è®¤ä¿ç•™ 30 å¤©)
```

### æ€»ä½“å½±å“
```
CPU: +2-3%
å†…å­˜: +500MB
ç£ç›˜: +2GB/æœˆ
ç½‘ç»œ: +50KB/s

è¯„ä»·: âœ… å¯æ¥å—çš„å¼€é”€
```

---

## ğŸ‰ é›†æˆå®Œæˆæ€»ç»“

### âœ… å·²å®Œæˆ
1. **Consul æœåŠ¡å‘ç°** - åŠ¨æ€æœåŠ¡å‘ç°å’Œå¥åº·æ£€æŸ¥
2. **Jaeger åˆ†å¸ƒå¼è¿½è¸ª** - å®Œæ•´è°ƒç”¨é“¾è·¯å¯è§†åŒ–
3. **Prometheus ç›‘æ§** - å…¨æ–¹ä½æŒ‡æ ‡æ”¶é›†
4. **Grafana å¯è§†åŒ–** - ç¾è§‚çš„ç›‘æ§å¤§ç›˜
5. **AlertManager å‘Šè­¦** - æ™ºèƒ½å‘Šè­¦é€šçŸ¥
6. **å®Œæ•´æ–‡æ¡£** - 1000+ è¡Œæ–‡æ¡£

### ğŸ“Š ç³»ç»Ÿèƒ½åŠ›

**å¯è§‚æµ‹æ€§**: â­â­â­â­â­ å®Œæ•´
- âœ… æŒ‡æ ‡ (Metrics)
- âœ… è¿½è¸ª (Tracing)
- âœ… æ—¥å¿— (Logs)

**ç”Ÿäº§å°±ç»ªåº¦**: â­â­â­â­â­ å®Œå…¨å°±ç»ª
- âœ… é«˜å¯ç”¨é…ç½®
- âœ… æ•°æ®æŒä¹…åŒ–
- âœ… å‘Šè­¦é€šçŸ¥
- âœ… æ€§èƒ½ä¼˜åŒ–

---

## ğŸš€ ç«‹å³ä½¿ç”¨

### 1. å¯åŠ¨ç›‘æ§ç³»ç»Ÿ
```bash
cd infrastructure/monitoring
./start-monitoring.sh
```

### 2. è®¿é—®ç•Œé¢
- **Jaeger**: http://localhost:16686
- **Prometheus**: http://localhost:9090
- **Grafana**: http://localhost:3000 (admin/admin123)

### 3. å‘é€æµ‹è¯•è¯·æ±‚
```bash
# é€šè¿‡ Envoy å‘é€è¯·æ±‚ï¼ˆä¼šè¢«è¿½è¸ªï¼‰
curl http://localhost:10000/api/users
```

### 4. æŸ¥çœ‹æ•ˆæœ
- Jaeger: æŸ¥çœ‹è°ƒç”¨é“¾è·¯
- Prometheus: æŸ¥è¯¢æŒ‡æ ‡
- Grafana: æŸ¥çœ‹ä»ªè¡¨ç›˜

---

**ä¸‰å¤§é›†æˆå…¨éƒ¨å®Œæˆï¼äº«å—ä¼ä¸šçº§çš„ç›‘æ§å’Œå¯è§‚æµ‹æ€§ï¼** ğŸ‰

**é›†æˆå®Œæˆæ—¶é—´**: 2025-10-21  
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª  
**æ–‡æ¡£å®Œæ•´åº¦**: 100%








