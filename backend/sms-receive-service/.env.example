# ========================================
# SMS Receive Service 环境变量配置示例
# 复制此文件为 .env 并填入实际值
# ========================================

# ===== 运行环境 =====
NODE_ENV=development
PORT=30008
SERVICE_NAME=sms-receive-service

# ===== 数据库配置 =====
DB_HOST=localhost
DB_PORT=5432
DB_USERNAME=postgres
DB_PASSWORD=postgres
DB_DATABASE=cloudphone_sms

# ===== 数据库连接池配置（极致优化）=====
# 最小连接数（默认：CPU 核心数 / 2，至少 2，自动计算）
DB_POOL_MIN=2

# 最大连接数（默认：CPU 核心数 × 2 + 1，自动计算）
DB_POOL_MAX=9

# 连接获取超时（毫秒，默认 10秒）
DB_CONNECTION_TIMEOUT=10000

# 空闲连接超时（毫秒，默认 30秒）
DB_IDLE_TIMEOUT=30000

# 软空闲超时（毫秒，默认 60秒）
DB_SOFT_IDLE_TIMEOUT=60000

# 语句超时（毫秒，生产 30秒，开发 60秒）
DB_STATEMENT_TIMEOUT=30000

# 查询超时（毫秒，生产 30秒，开发 60秒）
DB_QUERY_TIMEOUT=30000

# 连接最大生命周期（秒，生产 30分钟，开发 无限制）
DB_MAX_LIFETIME=1800

# Prepared Statement 缓存查询数量（默认 256）
# ⭐ sms-receive-service 写入密集型特别受益
DB_PREPARED_STATEMENT_CACHE_QUERIES=256

# Prepared Statement 缓存大小（MB，默认 25）
DB_PREPARED_STATEMENT_CACHE_SIZE=25

# 慢查询阈值（毫秒，sms-receive-service 标准优化：1000ms）
# ⭐ 标准阈值，适合 SMS 接收和存储服务
DB_SLOW_QUERY_THRESHOLD=1000

# 连接池资源检查间隔（毫秒，默认 10秒）
DB_EVICTION_RUN_INTERVAL=10000

# 应用名称（用于数据库连接标识）
DB_APPLICATION_NAME=sms-receive-service

# SSL 配置（生产环境建议启用）
DB_SSL_REJECT_UNAUTHORIZED=true

# ===== Redis 配置 =====
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
REDIS_CACHE_DB=1

# ===== JWT 配置 =====
# 重要: 必须与其他服务保持一致
JWT_SECRET=your-secret-key-change-in-production-use-at-least-32-characters
JWT_EXPIRES_IN=24h

# ===== RabbitMQ 配置 =====
RABBITMQ_URL=amqp://admin:admin123@localhost:5672/cloudphone
RABBITMQ_EXCHANGE=cloudphone.events
RABBITMQ_QUEUE_PREFIX=sms-receive-service

# ===== Consul 配置 =====
CONSUL_HOST=localhost
CONSUL_PORT=8500
CONSUL_SERVICE_NAME=sms-receive-service
CONSUL_SERVICE_PORT=30008

# ===== SMS 提供商配置 =====
# SMS-Activate
SMS_ACTIVATE_API_KEY=your_api_key_here
SMS_ACTIVATE_BASE_URL=https://api.sms-activate.org/stubs/handler_api.php

# 5sim
FIVESIM_API_KEY=your_api_key_here
FIVESIM_BASE_URL=https://5sim.net/v1

# ===== 号码池配置 =====
NUMBER_POOL_MIN_SIZE=100
NUMBER_POOL_TARGET_SIZE=200
NUMBER_POOL_MAX_SIZE=500
NUMBER_POOL_REFRESH_INTERVAL=300000  # 5分钟（毫秒）

# ===== 消息轮询配置 =====
MESSAGE_POLLING_INTERVAL=10000  # 10秒（毫秒）
MESSAGE_POLLING_TIMEOUT=5000    # 5秒（毫秒）
MESSAGE_MAX_AGE=3600000         # 1小时（毫秒）

# ===== 验证码配置 =====
VERIFICATION_CODE_CACHE_TTL=600  # 10分钟（秒）
VERIFICATION_CODE_RETRY_LIMIT=5

# ===== A/B 测试配置 =====
AB_TEST_ENABLED=true
AB_TEST_TRAFFIC_SPLIT=50  # 百分比

# ===== 黑名单配置 =====
BLACKLIST_ENABLED=true
BLACKLIST_AUTO_ADD=true
BLACKLIST_THRESHOLD=3  # 失败次数阈值

# ===== 日志配置 =====
LOG_LEVEL=info  # debug | info | warn | error
LOG_FORMAT=json  # json | pretty

# ===== 健康检查配置 =====
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_DATABASE=true
HEALTH_CHECK_REDIS=true
HEALTH_CHECK_RABBITMQ=true

# ===== 监控配置 =====
METRICS_ENABLED=true
METRICS_PORT=30008
METRICS_PATH=/metrics
