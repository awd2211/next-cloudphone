# ========================================
# Billing Service 环境变量配置示例
# 复制此文件为 .env 并填入实际值
# ========================================

# ===== 运行环境 =====
NODE_ENV=development
PORT=30005

# ===== 数据库配置 =====
DB_HOST=localhost
DB_PORT=5432
DB_USERNAME=postgres
DB_PASSWORD=postgres
DB_DATABASE=cloudphone_billing

# ===== 数据库连接池配置（极致优化 - 针对聚合查询）=====
# 最小连接数（默认：CPU 核心数 / 2，至少 2，自动计算）
DB_POOL_MIN=2

# 最大连接数（默认：CPU 核心数 × 2 + 1，自动计算）
DB_POOL_MAX=9

# 连接获取超时（毫秒，默认 10秒）
DB_CONNECTION_TIMEOUT=10000

# 空闲连接超时（毫秒，默认 30秒）
DB_IDLE_TIMEOUT=30000

# 软空闲超时（毫秒，默认 60秒）
DB_SOFT_IDLE_TIMEOUT=60000

# 语句超时（毫秒，生产 30秒，开发 60秒）
DB_STATEMENT_TIMEOUT=30000

# 查询超时（毫秒，生产 30秒，开发 60秒）
DB_QUERY_TIMEOUT=30000

# 连接最大生命周期（秒，生产 30分钟，开发 无限制）
DB_MAX_LIFETIME=1800

# Prepared Statement 缓存查询数量（默认 256）
# ⭐ billing-service 聚合查询特别受益
DB_PREPARED_STATEMENT_CACHE_QUERIES=256

# Prepared Statement 缓存大小（MB，默认 25）
DB_PREPARED_STATEMENT_CACHE_SIZE=25

# 慢查询阈值（毫秒，billing-service 特别优化：500ms）
# ⭐ 更严格的阈值，快速发现聚合查询性能问题
DB_SLOW_QUERY_THRESHOLD=500

# 连接池资源检查间隔（毫秒，默认 10秒）
DB_EVICTION_RUN_INTERVAL=10000

# 应用名称（用于数据库连接标识）
DB_APPLICATION_NAME=billing-service

# SSL 配置（生产环境建议启用）
DB_SSL_REJECT_UNAUTHORIZED=true

# ===== Redis 配置 =====
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=

# ===== JWT 配置 =====
# 重要: 必须与其他服务保持一致
JWT_SECRET=your-secret-key-change-in-production-use-at-least-32-characters
JWT_EXPIRES_IN=24h

# ===== RabbitMQ 配置 =====
RABBITMQ_URL=amqp://admin:admin123@localhost:5672/cloudphone
RABBITMQ_EXCHANGE=cloudphone.events
RABBITMQ_QUEUE_PREFIX=billing-service

# RabbitMQ 消费者配置
RABBITMQ_PREFETCH_COUNT=10
RABBITMQ_RETRY_ATTEMPTS=3
RABBITMQ_RETRY_DELAY=1000  # 毫秒

# ===== Consul 配置 =====
CONSUL_HOST=localhost
CONSUL_PORT=8500
CONSUL_SERVICE_NAME=billing-service
CONSUL_SERVICE_PORT=30005

# ===== 计费配置 =====
BILLING_CURRENCY=CNY
BILLING_CYCLE=hourly  # hourly | daily | monthly
PRICE_PER_HOUR=1.0
PRICE_PER_GB_STORAGE=0.1
PRICE_PER_GB_TRAFFIC=0.5

# ===== 套餐配置 =====
ENABLE_PACKAGE_PLANS=true
FREE_TRIAL_DURATION=72  # 小时
FREE_TRIAL_CREDITS=100  # CNY

# ===== 订单配置 =====
ORDER_TIMEOUT=1800  # 30分钟 (秒)
ORDER_AUTO_CANCEL=true
INVOICE_GENERATION=true

# ===== 微信支付 =====
WECHAT_PAY_ENABLED=false
WECHAT_APP_ID=
WECHAT_MCH_ID=
WECHAT_SERIAL_NO=
WECHAT_API_V3_KEY=
WECHAT_PRIVATE_KEY=
WECHAT_PUBLIC_KEY=

# ===== 支付宝 =====
ALIPAY_ENABLED=false
ALIPAY_APP_ID=
ALIPAY_PRIVATE_KEY=
ALIPAY_PUBLIC_KEY=
ALIPAY_GATEWAY=https://openapi.alipay.com/gateway.do

# ===== PayPal (全球支付) =====
PAYPAL_ENABLED=true
PAYPAL_MODE=sandbox  # sandbox | production
PAYPAL_SANDBOX_CLIENT_ID=xxx
PAYPAL_SANDBOX_SECRET=xxx
PAYPAL_LIVE_CLIENT_ID=xxx
PAYPAL_LIVE_SECRET=xxx
PAYPAL_WEBHOOK_ID=xxx

# ===== Paddle (SaaS 订阅专用) =====
PADDLE_ENABLED=true
PADDLE_ENVIRONMENT=sandbox  # sandbox | production
PADDLE_API_KEY=xxx
PADDLE_WEBHOOK_SECRET=xxx

# ===== Stripe (国际信用卡支付) =====
STRIPE_ENABLED=true
STRIPE_MODE=test  # test | live
STRIPE_TEST_PUBLIC_KEY=pk_test_xxx
STRIPE_TEST_SECRET_KEY=sk_test_xxx
STRIPE_LIVE_PUBLIC_KEY=pk_live_xxx
STRIPE_LIVE_SECRET_KEY=sk_live_xxx
STRIPE_WEBHOOK_SECRET=whsec_xxx

# ===== 账单配置 =====
INVOICE_EMAIL_ENABLED=true
INVOICE_AUTO_SEND=true
INVOICE_GENERATION_DAY=1

# ===== 欠费处理 =====
ENABLE_OVERDUE_CHECK=true
OVERDUE_GRACE_PERIOD=3  # 天
OVERDUE_SUSPEND_DEVICES=true

# ===== 汇率 API =====
EXCHANGE_RATE_API_KEY=  # 可选，留空使用免费 API

# ===== 前端 URL =====
FRONTEND_URL=http://localhost:5173
API_GATEWAY_URL=http://localhost:30000

# ===== 服务地址 =====
DEVICE_SERVICE_URL=http://localhost:30002
USER_SERVICE_URL=http://localhost:30001
NOTIFICATION_SERVICE_URL=http://localhost:30006
API_GATEWAY_URL=http://localhost:30000

# ===== 日志配置 =====
LOG_LEVEL=debug
LOG_FORMAT=dev
