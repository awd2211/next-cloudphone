# ========================================
# Proxy Service 环境变量配置示例
# 复制此文件为 .env 并填入实际值
# ========================================

# ===== 运行环境 =====
NODE_ENV=development
PORT=30007
SERVICE_NAME=proxy-service

# ===== CORS 配置 =====
CORS_ORIGIN=http://localhost:5173,http://localhost:5174

# ===== 数据库配置 =====
DB_HOST=localhost
DB_PORT=5432
DB_USERNAME=postgres
DB_PASSWORD=postgres
DB_DATABASE=cloudphone_proxy

# ===== 数据库连接池配置（极致优化）=====
# 最小连接数（默认：CPU 核心数 / 2，至少 2，自动计算）
DB_POOL_MIN=2

# 最大连接数（默认：CPU 核心数 × 2 + 1，自动计算）
DB_POOL_MAX=9

# 连接获取超时（毫秒，默认 10秒）
DB_CONNECTION_TIMEOUT=10000

# 空闲连接超时（毫秒，默认 30秒）
DB_IDLE_TIMEOUT=30000

# 软空闲超时（毫秒，默认 60秒）
DB_SOFT_IDLE_TIMEOUT=60000

# 语句超时（毫秒，生产 30秒，开发 60秒）
DB_STATEMENT_TIMEOUT=30000

# 查询超时（毫秒，生产 30秒，开发 60秒）
DB_QUERY_TIMEOUT=30000

# 连接最大生命周期（秒，生产 30分钟，开发 无限制）
DB_MAX_LIFETIME=1800

# Prepared Statement 缓存查询数量（默认 256）
# ⭐ proxy-service 高并发查询特别受益
DB_PREPARED_STATEMENT_CACHE_QUERIES=256

# Prepared Statement 缓存大小（MB，默认 25）
DB_PREPARED_STATEMENT_CACHE_SIZE=25

# 慢查询阈值（毫秒，proxy-service 标准优化：1000ms）
# ⭐ 标准阈值，适合高并发读取为主的服务
DB_SLOW_QUERY_THRESHOLD=1000

# 连接池资源检查间隔（毫秒，默认 10秒）
DB_EVICTION_RUN_INTERVAL=10000

# 应用名称（用于数据库连接标识）
DB_APPLICATION_NAME=proxy-service

# SSL 配置（生产环境建议启用）
DB_SSL_REJECT_UNAUTHORIZED=true

# ===== Redis 配置 =====
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
REDIS_CACHE_DB=1

# ===== JWT 配置 =====
# 重要: 必须与其他服务保持一致
JWT_SECRET=your-secret-key-change-in-production-use-at-least-32-characters
JWT_EXPIRES_IN=24h

# ===== RabbitMQ 配置 =====
RABBITMQ_URL=amqp://admin:admin123@localhost:5672/cloudphone
RABBITMQ_EXCHANGE=cloudphone.events
RABBITMQ_QUEUE_PREFIX=proxy-service

# RabbitMQ 消费者配置
RABBITMQ_PREFETCH_COUNT=10
RABBITMQ_RETRY_ATTEMPTS=3
RABBITMQ_RETRY_DELAY=1000  # 毫秒

# ===== Consul 配置 =====
CONSUL_HOST=localhost
CONSUL_PORT=8500
CONSUL_SERVICE_NAME=proxy-service
CONSUL_SERVICE_PORT=30007

# 代理池配置
POOL_MIN_SIZE=1000
POOL_TARGET_SIZE=2000
POOL_MAX_SIZE=5000
POOL_REFRESH_INTERVAL=600000  # 10分钟（毫秒）

# 健康检查配置
HEALTH_CHECK_INTERVAL=120000  # 2分钟（毫秒）
HEALTH_CHECK_TIMEOUT=10000    # 10秒（毫秒）
HEALTH_CHECK_RETRIES=3

# 成本控制配置
MONTHLY_BUDGET=3000           # 月预算（USD）
COST_ALERT_THRESHOLD=0.8      # 80%告警阈值
COST_PROTECTION_THRESHOLD=0.95 # 95%保护模式阈值

# IPRoyal配置
IPROYAL_USERNAME=your_username
IPROYAL_PASSWORD=your_password
IPROYAL_API_URL=https://resi-api.iproyal.com/v1

# Bright Data配置
BRIGHTDATA_API_KEY=your_api_key
BRIGHTDATA_ZONE=residential
BRIGHTDATA_USERNAME=your_username
BRIGHTDATA_PASSWORD=your_password
BRIGHTDATA_API_URL=https://api.brightdata.com
BRIGHTDATA_COST_PER_GB=10          # 每GB成本（USD）

# Oxylabs配置
OXYLABS_USERNAME=your_username
OXYLABS_PASSWORD=your_password
OXYLABS_API_URL=https://api.oxylabs.io
OXYLABS_PROXY_TYPE=residential     # residential 或 datacenter
OXYLABS_COST_PER_GB=12             # 每GB成本（USD）

# IPIDEA配置（家宽代理）
# API 文档: https://www.ipidea.net/ucenter/ipidea-api.html
IPIDEA_API_KEY=your_api_key        # 用户API密钥 (appkey)
IPIDEA_USERNAME=your_username      # 认证账户用户名（不含-zone-custom后缀）
IPIDEA_PASSWORD=your_password      # 认证账户密码
IPIDEA_API_URL=https://api.ipidea.net
IPIDEA_PROXY_TYPE=residential      # residential, datacenter, mobile, isp
IPIDEA_COST_PER_GB=3               # 每GB成本（USD）
# 代理网关配置（可选，用户特定的网关地址）
IPIDEA_GATEWAY=                    # 如: e255c08e04856698.lqz.na.ipidea.online
IPIDEA_PORT=2336                   # 代理端口（默认2336）

# 日志配置
LOG_LEVEL=info

# Prometheus配置
PROMETHEUS_PORT=30008
