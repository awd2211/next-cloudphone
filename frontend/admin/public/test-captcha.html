<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ç®€å•å‰ç«¯æµ‹è¯•</title>
    <style>
        body { font-family: Arial; padding: 20px; max-width: 800px; margin: 0 auto; }
        button { padding: 10px 20px; margin: 10px; font-size: 16px; cursor: pointer; }
        .result { margin: 20px 0; padding: 15px; background: #f5f5f5; border-radius: 4px; }
        .success { color: green; }
        .error { color: red; }
        #captcha { margin: 20px 0; padding: 20px; border: 2px solid #ddd; min-height: 50px; }
    </style>
</head>
<body>
    <h1>ğŸ” ç®€å•å‰ç«¯æµ‹è¯• - ä» localhost:5173 è®¿é—®</h1>
    <p><strong>é‡è¦ï¼š</strong>è¯·å°†æ­¤æ–‡ä»¶å†…å®¹ä¿å­˜åˆ°å‰ç«¯é¡¹ç›®ä¸­ï¼Œç„¶åé€šè¿‡ http://localhost:5173 è®¿é—®</p>

    <h2>æµ‹è¯• 1: ç›´æ¥ Fetch</h2>
    <button onclick="testFetch()">æµ‹è¯• Fetch API</button>
    <div id="fetch-result" class="result">ç­‰å¾…æµ‹è¯•...</div>

    <h2>æµ‹è¯• 2: ä½¿ç”¨å‰ç«¯ç›¸åŒçš„ baseURL</h2>
    <button onclick="testWithBaseURL()">ä½¿ç”¨ baseURL æµ‹è¯•</button>
    <div id="baseurl-result" class="result">ç­‰å¾…æµ‹è¯•...</div>

    <h2>éªŒè¯ç æ˜¾ç¤º</h2>
    <div id="captcha"></div>

    <script>
        const API_BASE = 'http://localhost:30000';

        function log(elementId, message, isError = false) {
            const el = document.getElementById(elementId);
            const className = isError ? 'error' : 'success';
            el.innerHTML += `<div class="${className}">${message}</div>`;
        }

        function clear(elementId) {
            document.getElementById(elementId).innerHTML = '<div>å¼€å§‹æµ‹è¯•...</div>';
        }

        async function testFetch() {
            clear('fetch-result');
            const url = `${API_BASE}/auth/captcha`;

            try {
                log('fetch-result', `æ­£åœ¨è¯·æ±‚: ${url}`);
                log('fetch-result', `å½“å‰é¡µé¢: ${window.location.origin}`);

                const startTime = Date.now();
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const duration = Date.now() - startTime;
                log('fetch-result', `å“åº”çŠ¶æ€: ${response.status} (${duration}ms)`, !response.ok);

                if (response.ok) {
                    const data = await response.json();
                    log('fetch-result', `âœ… æˆåŠŸï¼ID: ${data.id}`);
                    log('fetch-result', `SVG é•¿åº¦: ${data.svg.length}`);
                    document.getElementById('captcha').innerHTML = data.svg;
                } else {
                    const text = await response.text();
                    log('fetch-result', `âŒ é”™è¯¯å“åº”: ${text.substring(0, 200)}`, true);
                }
            } catch (error) {
                log('fetch-result', `âŒ å¼‚å¸¸: ${error.message}`, true);
                log('fetch-result', `é”™è¯¯ç±»å‹: ${error.constructor.name}`, true);
                if (error.stack) {
                    log('fetch-result', `å †æ ˆ: ${error.stack.split('\n')[0]}`, true);
                }
            }
        }

        async function testWithBaseURL() {
            clear('baseurl-result');

            // æ¨¡æ‹Ÿå‰ç«¯çš„ axios é…ç½®
            const baseURL = 'http://localhost:30000';
            const endpoint = '/auth/captcha';
            const fullURL = baseURL + endpoint;

            try {
                log('baseurl-result', `baseURL: ${baseURL}`);
                log('baseurl-result', `endpoint: ${endpoint}`);
                log('baseurl-result', `å®Œæ•´URL: ${fullURL}`);

                const startTime = Date.now();
                const response = await fetch(fullURL, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Request-ID': `test_${Date.now()}`
                    }
                });

                const duration = Date.now() - startTime;
                log('baseurl-result', `å“åº”æ—¶é—´: ${duration}ms`);
                log('baseurl-result', `çŠ¶æ€: ${response.status}`, !response.ok);

                if (response.ok) {
                    const data = await response.json();
                    log('baseurl-result', `âœ… æˆåŠŸï¼`);
                    log('baseurl-result', `ID: ${data.id}`);
                    document.getElementById('captcha').innerHTML = data.svg;
                } else {
                    log('baseurl-result', `âŒ å¤±è´¥`, true);
                }
            } catch (error) {
                log('baseurl-result', `âŒ é”™è¯¯: ${error.message}`, true);
                console.error('Complete error:', error);
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºç¯å¢ƒä¿¡æ¯
        window.addEventListener('load', () => {
            console.log('é¡µé¢ä½ç½®:', window.location.href);
            console.log('Origin:', window.location.origin);
            console.log('API Base:', API_BASE);
        });
    </script>
</body>
</html>
